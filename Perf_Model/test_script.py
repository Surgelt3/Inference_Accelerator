import re

pattern = re.compile(r'([*+=]?)\s*([+-]?\d+(?:\.\d+)?(?:e[+-]?\d+)?)')

text = """
0*-0.0938015+0.668726*0.276095+0.670214*0.170192+0*0.202546+0.668733*-0.0133101+0.670221*0.0396671+0*0.185933+0.668739*-0.0322457+0.670227*0.182341=0.687607
0*0.202546+0.668733*-0.0133101+0.670221*0.0396671+0*0.185933+0.668739*-0.0322457+0.670227*0.182341+0*0.276095+0.668746*0.170192+0.670234*0.18707=0.628106
0*0.185933+0.668739*-0.0322457+0.670227*0.182341+0*0.276095+0.668746*0.170192+0.670234*0.18707+0*-0.0133101+0.668753*0.0396671+0.670241*-0.141432=0.542155
0*0.276095+0.668746*0.170192+0.670234*0.18707+0*-0.0133101+0.668753*0.0396671+0.670241*-0.141432+0*-0.0322457+0.668759*0.182341+0.670247*0.053904=0.59958
0*-0.0133101+0.668753*0.0396671+0.670241*-0.141432+0*-0.0322457+0.668759*0.182341+0.670247*0.053904+0*0.170192+0.668766*0.18707+0.670254*0.219535=0.632635
0*-0.0036003+0.668029*-0.00796942+0.669517*-0.00108046+0*-0.00588238+0.668035*0.00374448+0.669523*0.00664703+0*-0.0201641+0.668042*0.00953301+0.66953*0.0169937=0.289231
0*-0.00588238+0.668035*0.00374448+0.669523*0.00664703+0*-0.0201641+0.668042*0.00953301+0.66953*0.0169937+0*-0.00796942+0.668048*-0.00108046+0.669537=0.294556
0*-0.0201641+0.668042*0.00953301+0.66953*0.0169937+0*-0.00796942+0.668048*-0.00108046+0.669537*0+0*0.00374448+0.668055*0.00664703+0.669543=0.292045
0*-0.00796942+0.668048*-0.00108046+0.669537*0+0*0.00374448+0.668055*0.00664703+0.669543*0+0*0.00953301+0.668062*0.0169937+0.66955*8.3097e-43=0.285651
"""  # shortened example


def chunk4(lst):
    """Yield list in chunks of 4 (padding with zeros)."""
    for i in range(0, len(lst), 4):
        chunk = lst[i:i+4]
        if len(chunk) < 4:
            chunk += [0.0] * (4 - len(chunk))
        yield chunk


with open("mem_init.txt", "w") as f:

    for line in text.strip().splitlines():

        list1 = []
        list2 = []
        list3 = []

        # Parse the line
        for op, num_str in pattern.findall(line):
            num = float(num_str)
            if op == '*':
                list2.append(num)
            elif op == '=':
                list3.append(num)
            else:
                list1.append(num)

        # Get all chunks of 4
        chunks1 = list(chunk4(list1))
        chunks2 = list(chunk4(list2))

        # Ensure both lists have same number of chunks
        max_chunks = max(len(chunks1), len(chunks2))
        while len(chunks1) < max_chunks:
            chunks1.append([0.0]*4)
        while len(chunks2) < max_chunks:
            chunks2.append([0.0]*4)

        # Write them interleaved
        for c1, c2 in zip(chunks1, chunks2):
            for v in c1:
                f.write(f"{v}\n")
            for v in c2:
                f.write(f"{v}\n")
